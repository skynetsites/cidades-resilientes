(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{4158:function(e,t,a){Promise.resolve().then(a.bind(a,158))},158:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var i=a(7437),s=a(2265),r=a(9376),n=a(2148),d=a(7293),l=a(6070),o=a(2869),c=a(5186),u=a(6818),m=a(8930),h=a(2369),x=a(8997),f=a(3417),p=a(5978),g=a(3145),v=a(4747),b=a(6916);function j(e){let{user:t}=e,a=(0,s.useRef)(null),[r,j]=(0,s.useState)(t),[y,N]=(0,s.useState)([]),[w,k]=(0,s.useState)({city:"",idea:""}),[C,z]=(0,s.useState)({author:"",text:""}),[S,I]=(0,s.useState)({open:!1,ideaId:void 0,parentId:null}),[D,U]=(0,s.useState)("ideias"),[E,A]=(0,s.useState)(1),[B,R]=(0,s.useState)(!1),[P,Z]=(0,s.useState)(!1),[L,O]=(0,s.useState)(!1),[J,M]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=(0,n.Aj)(d.I,e=>{j(e)});return()=>e()},[]),(0,s.useEffect)(()=>{(async()=>{try{let e=(await (0,p.PL)((0,p.hJ)(d.db,"ideas"))).docs.map(e=>{var t;let a=e.data();return{id:e.id,author:a.author||"An\xf4nimo",email:a.email||"",photoURL:a.photoURL||"",city:a.city||"",idea:a.idea||"",likes:a.likes||0,likedBy:a.likedBy||[],time:(null===(t=a.time)||void 0===t?void 0:t.toDate)?a.time.toDate():new Date,comments:a.comments||[]}}).sort((e,t)=>t.time.getTime()-e.time.getTime());N(e)}catch(e){console.error("Erro ao buscar ideias:",e)}})()},[]),(0,s.useEffect)(()=>{S.open&&r&&z(e=>({...e,author:r.displayName||r.email||""}))},[S.open,r]);let T=e=>e?e.toDate?(0,v.Q)(e.toDate(),{addSuffix:!0,locale:b.F}):"string"==typeof e?e:(0,v.Q)(e,{addSuffix:!0,locale:b.F}):"Agora",_=async e=>{if(e.preventDefault(),r){if(!/^[^,]+,\s*[^,]+$/.test(w.city)){alert("Por favor, insira no formato: Cidade, Pa\xeds");return}if(w.idea.trim().length<10){alert("A ideia deve ter pelo menos 10 caracteres.");return}try{var t;R(!0);let e=await (0,p.ET)((0,p.hJ)(d.db,"ideas"),{author:r.displayName,email:r.email,photoURL:r.photoURL||"",city:w.city,idea:w.idea,likes:0,likedBy:[],time:(0,p.Bt)(),comments:[]}),i={id:e.id,author:r.displayName,email:r.email,photoURL:r.photoURL||"",city:w.city,idea:w.idea,likes:0,likedBy:[],time:new Date,comments:[]};N(e=>[i,...e]),k({city:"",idea:""}),A(1),O(!0),null===(t=a.current)||void 0===t||t.scrollIntoView({behavior:"smooth"}),await fetch("/api/save-to-sheet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ideaId:e.id,author:r.displayName,email:r.email,city:w.city,idea:w.idea,likes:0,comments:[]})}),setTimeout(()=>O(!1),3e3)}catch(e){console.error("Erro ao salvar ideia:",e)}finally{R(!1)}}},F=async e=>{if(!r)return;let t=y.find(t=>t.id===e);if(!t)return;let a=Array.isArray(t.likedBy)?t.likedBy:[],i=a.includes(r.email)?a.filter(e=>e!==r.email):[...a,r.email];await (0,p.r7)((0,p.JU)(d.db,"ideas",e),{likedBy:i,likes:i.length}),N(t=>t.map(t=>t.id===e?{...t,likedBy:i,likes:i.length}:t))},Y=async e=>{if(e.preventDefault(),!C.author||!C.text||!S.ideaId)return;let t=(0,p.JU)(d.db,"ideas",S.ideaId),a={id:Date.now(),author:C.author,email:null==r?void 0:r.email,text:C.text,time:new Date,replies:[]};try{Z(!0);let e=y.find(e=>e.id===S.ideaId);if(!e)return;let i=[...e.comments||[]],s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(e=>e.id===S.parentId?{...e,replies:[...e.replies||[],a]}:{...e,replies:s(e.replies||[])})};S.parentId?i=s(i):i.push(a),await (0,p.r7)(t,{comments:i}),N(e=>e.map(e=>e.id===S.ideaId?{...e,comments:i}:e)),await fetch("/api/save-to-sheet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ideaId:e.id,comments:i})}),z({author:"",text:""}),I({open:!1}),M(!0),setTimeout(()=>M(!1),1e3)}catch(e){console.error("Erro ao adicionar coment\xe1rio:",e)}finally{Z(!1)}},q=async e=>{try{await (0,p.oe)((0,p.JU)(d.db,"ideas",e)),N(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Erro ao remover ideia:",e)}},V=async(e,t)=>{try{let a=y.find(t=>t.id===e);if(!a)return;let i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(e=>e.id!==t).map(e=>({...e,replies:i(e.replies||[])}))},s=i(a.comments);await (0,p.r7)((0,p.JU)(d.db,"ideas",e),{comments:s}),N(t=>t.map(t=>t.id===e?{...t,comments:s}:t)),await fetch("/api/save-to-sheet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ideaId:e,comments:s})})}catch(e){console.error("Erro ao remover coment\xe1rio:",e)}},$=(e,t)=>e.map(e=>{var a;return(0,i.jsxs)("div",{className:"ml-0 border-b border-muted/20 py-1",children:[(0,i.jsxs)("p",{children:[(0,i.jsxs)("span",{className:"font-semibold",children:[e.author,":"]})," ",e.text," ",(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",T(e.time),")"]})]}),(0,i.jsxs)("div",{className:"flex gap-2 mt-1",children:[(null==r?void 0:r.email)&&(0,i.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>I({open:!0,ideaId:t,parentId:e.id}),children:"Responder"}),(null==r?void 0:r.email)&&e.email&&r.email===e.email&&(0,i.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>V(t,e.id),children:(0,i.jsx)(m.Z,{className:"h-4 w-4 text-red-500"})})]}),(null===(a=e.replies)||void 0===a?void 0:a.length)?(0,i.jsx)("div",{className:"ml-4",children:$(e.replies,t)}):null]},e.id)}),K=e=>{let t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.some(e=>e.email===(null==r?void 0:r.email)||e.replies&&t(e.replies))};return t(e.comments||[])},Q=y.filter(e=>"ideias"===D?e.email===(null==r?void 0:r.email):"comentarios"!==D||K(e)),W=Math.max(1,Math.ceil(Q.length/5)),G=5*E,H=Q.slice(G-5,G);return(0,i.jsx)("section",{className:"pt-40 py-20 bg-muted/30",children:(0,i.jsxs)("div",{ref:a,className:"container mx-auto px-4",children:[(0,i.jsxs)("div",{className:"max-w-6xl mx-auto text-center mb-16",children:[(0,i.jsx)("h2",{className:"text-4xl md:text-5xl font-bold text-foreground mb-4",children:"Meu Dashboard"}),(0,i.jsx)("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto leading-relaxed mb-7",children:"Aqui voc\xea pode acompanhar suas ideias, coment\xe1rios e dados."}),(0,i.jsxs)("h3",{className:"text-xl md:text-2xl font-bold text-foreground",children:["Bem-vindo, ",(null==r?void 0:r.displayName)||(null==r?void 0:r.email)]})]}),(0,i.jsx)("div",{className:"flex justify-center mb-8",children:(0,i.jsxs)("div",{className:"flex bg-background rounded-lg p-1 border border-border space-x-2",children:[(0,i.jsx)(o.z,{variant:"ideias"===D?"default":"ghost",onClick:()=>U("ideias"),className:"cursor-pointer",children:"Minhas Ideias"}),(0,i.jsx)(o.z,{variant:"comentarios"===D?"default":"ghost",onClick:()=>U("comentarios"),className:"cursor-pointer",children:"Meus Coment\xe1rios"}),(0,i.jsx)(o.z,{variant:"cursos"===D?"default":"ghost",onClick:()=>U("cursos"),className:"cursor-pointer",children:"Meus Cursos"}),(0,i.jsx)(o.z,{variant:"dados"===D?"default":"ghost",onClick:()=>U("dados"),className:"cursor-pointer",children:"Meus Dados"})]})}),(0,i.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[("ideias"===D||"comentarios"===D)&&(0,i.jsx)("div",{className:"lg:col-span-1 mb-8",children:(0,i.jsxs)(l.Zb,{className:"bg-card border-border sticky top-24",children:[(0,i.jsx)(l.Ol,{children:(0,i.jsx)(l.ll,{children:"Compartilhe sua ideia"})}),(0,i.jsx)(l.aY,{children:(0,i.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,i.jsx)(c.I,{placeholder:"Cidade, Pa\xeds",value:w.city,onChange:e=>k({...w,city:e.target.value}),required:!0,disabled:!r,pattern:"^[^,]+,\\s*[^,]+$",title:"Digite no formato: Cidade, Pa\xeds"}),(0,i.jsx)(u.g,{placeholder:r?"Descreva sua ideia...":"Fa\xe7a login para adicionar ideias",value:w.idea,onChange:e=>k({...w,idea:e.target.value}),required:!0,rows:3,disabled:!r,minLength:10,title:"A ideia deve ter pelo menos 10 caracteres"}),(0,i.jsx)(o.z,{type:"submit",disabled:!r,onClick:()=>U("ideias"),className:"cursor-pointer",children:r?"Compartilhar":"Fa\xe7a login para compartilhar"})]})})]})}),"dados"!==D&&"cursos"!==D&&(0,i.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[0===H.length&&(0,i.jsx)("div",{className:"px-10 py-5 text-xl md:text-base text-muted-foreground",children:"ideias"===D?"Voc\xea ainda n\xe3o tem ideias cadastradas.":"comentarios"===D?"Voc\xea ainda n\xe3o comentou em nenhuma ideia.":""}),H.map(e=>{var t,a,s;return(0,i.jsx)(l.Zb,{className:"bg-card border-border hover:shadow-lg transition-shadow relative",children:(0,i.jsxs)(l.aY,{children:[(0,i.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("div",{className:"bg-emerald-500/10 p-2 rounded-full",children:e.photoURL?(0,i.jsx)(g.default,{src:e.photoURL,alt:e.author,width:32,height:32,className:"rounded-full"}):(0,i.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,i.jsx)(h.Z,{className:"h-4 w-4 text-white"})})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-semibold",children:e.author}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:e.city})]})]}),(0,i.jsx)("span",{className:"text-xs text-muted-foreground",children:T(e.time)})]}),(0,i.jsx)("p",{className:"mb-4 leading-relaxed",children:e.idea}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)(o.z,{onClick:()=>F(e.id),variant:"ghost",size:"sm",children:[(0,i.jsx)(x.Z,{className:"h-4 w-4 mr-1 ".concat((null===(t=e.likedBy)||void 0===t?void 0:t.length)?"text-red-500":"text-white")}),e.likes]}),(0,i.jsxs)("div",{className:"flex items-center justify-end w-full gap-2",children:[(0,i.jsxs)(o.z,{onClick:()=>I({open:!0,ideaId:e.id}),variant:"ghost",size:"sm",disabled:!r,children:[(0,i.jsx)(f.Z,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"ml-1",children:(null===(a=e.comments)||void 0===a?void 0:a.length)||0})]}),(null==r?void 0:r.email)&&e.email&&r.email===e.email&&(0,i.jsx)(o.z,{onClick:()=>q(e.id),variant:"ghost",size:"sm",children:(0,i.jsx)(m.Z,{className:"h-4 w-4 text-red-500"})})]})]}),(null===(s=e.comments)||void 0===s?void 0:s.length)?$(e.comments,e.id):null]})},e.id)}),Q.length>5&&(0,i.jsxs)("div",{className:"flex justify-center gap-4 mt-6",children:[(0,i.jsx)(o.z,{onClick:()=>A(e=>Math.max(e-1,1)),disabled:1===E,children:"Anterior"}),(0,i.jsxs)("span",{className:"flex items-center gap-2",children:["P\xe1gina ",E," de ",W]}),(0,i.jsx)(o.z,{onClick:()=>A(e=>Math.min(e+1,W)),disabled:E===W,children:"Pr\xf3ximo"})]})]})]}),"cursos"===D&&(0,i.jsx)("div",{className:"max-w-md mx-auto",children:(0,i.jsxs)(l.Zb,{className:"bg-card border-border",children:[(0,i.jsx)(l.Ol,{children:(0,i.jsx)(l.ll,{className:"flex flex-col items-center",children:"Meus Cursos"})}),(0,i.jsx)(l.aY,{className:"flex flex-col items-center gap-4",children:r?(0,i.jsx)("div",{className:"text-center text-muted-foreground",children:(0,i.jsx)("h2",{children:"No momento n\xe3o h\xe1 cursos cadastrados."})}):(0,i.jsx)("div",{className:"text-center text-muted-foreground",children:"Carregando cursos..."})})]})}),"dados"===D&&(0,i.jsx)("div",{className:"max-w-md mx-auto",children:(0,i.jsxs)(l.Zb,{className:"bg-card border-border",children:[(0,i.jsx)(l.Ol,{children:(0,i.jsx)(l.ll,{children:"Minhas Informa\xe7\xf5es"})}),(0,i.jsxs)(l.aY,{className:"flex flex-col items-center gap-4",children:[r?r.photoURL?(0,i.jsx)(g.default,{src:r.photoURL,alt:r.displayName||"Usu\xe1rio",width:100,height:100,className:"rounded-full"}):(0,i.jsx)("div",{className:"h-24 w-24 rounded-full bg-gray-300 flex items-center justify-center",children:(0,i.jsx)(h.Z,{className:"h-12 w-12 text-white"})}):(0,i.jsx)("div",{className:"text-center text-muted-foreground",children:"Carregando informa\xe7\xf5es..."}),r&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{className:"font-semibold text-lg",children:r.displayName||r.email}),(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Email: ",r.email]}),(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:["UID: ",r.uid]})]})]})]})}),S.open&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-card p-6 rounded-lg w-96",children:[(0,i.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Adicionar Coment\xe1rio"}),(0,i.jsxs)("form",{onSubmit:Y,className:"space-y-3",children:[(0,i.jsx)(c.I,{placeholder:"Seu nome",value:C.author||"",onChange:e=>z({...C,author:e.target.value}),required:!0,disabled:!!r}),(0,i.jsx)(u.g,{placeholder:"Coment\xe1rio",value:C.text||"",onChange:e=>z({...C,text:e.target.value}),rows:3,required:!0}),(0,i.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,i.jsx)(o.z,{type:"button",variant:"ghost",onClick:()=>I({open:!1}),children:"Cancelar"}),(0,i.jsx)(o.z,{type:"submit",children:"Enviar"})]})]})]})})]})})}var y=a(5082);function N(){let[e,t]=(0,s.useState)(!0),[a,l]=(0,s.useState)(null),o=(0,r.useRouter)();return((0,s.useEffect)(()=>{let e=(0,n.Aj)(d.I,e=>{e?l(e):o.replace("/login"),t(!1)});return()=>e()},[o]),e)?(0,i.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,i.jsx)(y.$,{className:"w-16 h-16"})}):(0,i.jsx)(j,{user:a})}},2869:function(e,t,a){"use strict";a.d(t,{z:function(){return l}});var i=a(7437);a(2265);var s=a(5293),r=a(535),n=a(4508);let d=(0,r.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:t,variant:a,size:r,asChild:l=!1,...o}=e,c=l?s.g7:"button";return(0,i.jsx)(c,{"data-slot":"button",className:(0,n.cn)(d({variant:a,size:r,className:t})),...o})}},6070:function(e,t,a){"use strict";a.d(t,{Ol:function(){return n},Zb:function(){return r},aY:function(){return l},ll:function(){return d}});var i=a(7437);a(2265);var s=a(4508);function r(e){let{className:t,...a}=e;return(0,i.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function n(e){let{className:t,...a}=e;return(0,i.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function d(e){let{className:t,...a}=e;return(0,i.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",t),...a})}function l(e){let{className:t,...a}=e;return(0,i.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",t),...a})}},5186:function(e,t,a){"use strict";a.d(t,{I:function(){return r}});var i=a(7437);a(2265);var s=a(4508);function r(e){let{className:t,type:a,...r}=e;return(0,i.jsx)("input",{type:a,"data-slot":"input",className:(0,s.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}},5082:function(e,t,a){"use strict";a.d(t,{$:function(){return s}});var i=a(7437);function s(e){let{className:t}=e;return(0,i.jsx)("div",{className:"animate-spin rounded-full border-4 border-t-4 border-gray-200 border-t-blue-500 ".concat(t||"w-8 h-8")})}},6818:function(e,t,a){"use strict";a.d(t,{g:function(){return r}});var i=a(7437);a(2265);var s=a(4508);function r(e){let{className:t,...a}=e;return(0,i.jsx)("textarea",{"data-slot":"textarea",className:(0,s.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}},7293:function(e,t,a){"use strict";a.d(t,{A:function(){return l},I:function(){return d},db:function(){return o}});var i=a(738),s=a(2148),r=a(5978);let n=(0,i.ZF)({apiKey:"AIzaSyBPx9Yu1fNRzptPdKjtSJjZ5SjBrW-mv1g",authDomain:"cidades-resilientes.firebaseapp.com",projectId:"cidades-resilientes",storageBucket:"cidades-resilientes.firebasestorage.app",messagingSenderId:"531178995997",appId:"1:531178995997:web:c20fa8e6f1afce48e421f4"}),d=(0,s.v0)(n),l=new s.hJ,o=(0,r.ad)(n)},4508:function(e,t,a){"use strict";a.d(t,{cn:function(){return r}});var i=a(1994),s=a(3335);function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,i.W)(t))}}},function(e){e.O(0,[609,15,2,129,971,117,744],function(){return e(e.s=4158)}),_N_E=e.O()}]);