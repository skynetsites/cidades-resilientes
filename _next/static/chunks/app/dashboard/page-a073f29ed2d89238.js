(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{4158:function(e,t,i){Promise.resolve().then(i.bind(i,158))},158:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return N}});var a=i(7437),r=i(2265),s=i(9376),n=i(2148),d=i(7293),l=i(6070),o=i(2869),c=i(5186),u=i(6818),m=i(8930),h=i(2369),x=i(8997),f=i(3417),p=i(5978),g=i(3145),v=i(4747),b=i(6916);function j(e){let{user:t}=e,i=(0,r.useRef)(null),[s,j]=(0,r.useState)(t),[y,N]=(0,r.useState)([]),[w,k]=(0,r.useState)({city:"",idea:""}),[C,z]=(0,r.useState)({author:"",text:""}),[S,I]=(0,r.useState)({open:!1,ideaId:void 0,parentId:null}),[D,U]=(0,r.useState)("ideias"),[E,A]=(0,r.useState)(1),[B,R]=(0,r.useState)(!1),[P,L]=(0,r.useState)(!1),[Z,J]=(0,r.useState)(!1),[O,T]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=(0,n.Aj)(d.I,e=>{j(e)});return()=>e()},[]),(0,r.useEffect)(()=>{(async()=>{try{let e=(await (0,p.PL)((0,p.hJ)(d.db,"ideas"))).docs.map(e=>{var t;let i=e.data();return{id:e.id,author:i.author||"An\xf4nimo",email:i.email||"",photoURL:i.photoURL||"",city:i.city||"",idea:i.idea||"",likes:i.likes||0,likedBy:i.likedBy||[],time:(null===(t=i.time)||void 0===t?void 0:t.toDate)?i.time.toDate():new Date,comments:i.comments||[]}}).sort((e,t)=>t.time.getTime()-e.time.getTime());N(e)}catch(e){console.error("Erro ao buscar ideias:",e)}})()},[]),(0,r.useEffect)(()=>{S.open&&s&&z(e=>({...e,author:s.displayName||s.email||""}))},[S.open,s]);let _=e=>e?e.toDate?(0,v.Q)(e.toDate(),{addSuffix:!0,locale:b.F}):"string"==typeof e?e:(0,v.Q)(e,{addSuffix:!0,locale:b.F}):"Agora",M=async e=>{if(e.preventDefault(),s){if(!/^[^,]+,\s*[^,]+$/.test(w.city)){alert("Por favor, insira no formato: Cidade, Pa\xeds");return}if(w.idea.trim().length<10){alert("A ideia deve ter pelo menos 10 caracteres.");return}try{var t;R(!0);let e=await (0,p.ET)((0,p.hJ)(d.db,"ideas"),{author:s.displayName,email:s.email,photoURL:s.photoURL||"",city:w.city,idea:w.idea,likes:0,likedBy:[],time:(0,p.Bt)(),comments:[]}),a={id:e.id,author:s.displayName,email:s.email,photoURL:s.photoURL||"",city:w.city,idea:w.idea,likes:0,likedBy:[],time:new Date,comments:[]};N(e=>[a,...e]),k({city:"",idea:""}),A(1),J(!0),null===(t=i.current)||void 0===t||t.scrollIntoView({behavior:"smooth"}),await fetch("/api/save-to-sheet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ideaId:e.id,author:s.displayName,email:s.email,city:w.city,idea:w.idea,likes:0,comments:[]})}),setTimeout(()=>J(!1),3e3)}catch(e){console.error("Erro ao salvar ideia:",e)}finally{R(!1)}}},F=async e=>{if(!s)return;let t=y.find(t=>t.id===e);if(!t)return;let i=Array.isArray(t.likedBy)?t.likedBy:[],a=i.includes(s.email)?i.filter(e=>e!==s.email):[...i,s.email];await (0,p.r7)((0,p.JU)(d.db,"ideas",e),{likedBy:a,likes:a.length}),N(t=>t.map(t=>t.id===e?{...t,likedBy:a,likes:a.length}:t))},q=async e=>{if(e.preventDefault(),!C.author||!C.text||!S.ideaId)return;let t=(0,p.JU)(d.db,"ideas",S.ideaId),i={id:Date.now(),author:C.author,email:null==s?void 0:s.email,text:C.text,time:new Date,replies:[]};try{L(!0);let e=y.find(e=>e.id===S.ideaId);if(!e)return;let a=[...e.comments||[]],r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(e=>e.id===S.parentId?{...e,replies:[...e.replies||[],i]}:{...e,replies:r(e.replies||[])})};S.parentId?a=r(a):a.push(i),await (0,p.r7)(t,{comments:a}),N(e=>e.map(e=>e.id===S.ideaId?{...e,comments:a}:e)),await fetch("/api/save-to-sheet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ideaId:e.id,comments:a})}),z({author:"",text:""}),I({open:!1}),T(!0),setTimeout(()=>T(!1),1e3)}catch(e){console.error("Erro ao adicionar coment\xe1rio:",e)}finally{L(!1)}},Y=async e=>{try{await (0,p.oe)((0,p.JU)(d.db,"ideas",e)),N(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Erro ao remover ideia:",e)}},V=async(e,t)=>{try{let i=y.find(t=>t.id===e);if(!i)return;let a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(e=>e.id!==t).map(e=>({...e,replies:a(e.replies||[])}))},r=a(i.comments);await (0,p.r7)((0,p.JU)(d.db,"ideas",e),{comments:r}),N(t=>t.map(t=>t.id===e?{...t,comments:r}:t)),await fetch("/api/save-to-sheet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ideaId:e,comments:r})})}catch(e){console.error("Erro ao remover coment\xe1rio:",e)}},$=(e,t)=>e.map(e=>{var i;return(0,a.jsxs)("div",{className:"ml-0 border-b border-muted/20 py-1",children:[(0,a.jsxs)("p",{children:[(0,a.jsxs)("span",{className:"font-semibold",children:[e.author,":"]})," ",e.text," ",(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",_(e.time),")"]})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-1",children:[(null==s?void 0:s.email)&&(0,a.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>I({open:!0,ideaId:t,parentId:e.id}),children:"Responder"}),(null==s?void 0:s.email)&&e.email&&s.email===e.email&&(0,a.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>V(t,e.id),children:(0,a.jsx)(m.Z,{className:"h-4 w-4 text-red-500"})})]}),(null===(i=e.replies)||void 0===i?void 0:i.length)?(0,a.jsx)("div",{className:"ml-4",children:$(e.replies,t)}):null]},e.id)}),K=e=>{let t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.some(e=>e.email===(null==s?void 0:s.email)||e.replies&&t(e.replies))};return t(e.comments||[])},Q=y.filter(e=>"ideias"===D?e.email===(null==s?void 0:s.email):"comentarios"!==D||K(e)),W=Math.max(1,Math.ceil(Q.length/5)),G=5*E,H=Q.slice(G-5,G);return(0,a.jsx)("section",{className:"pt-40 py-20 bg-muted/30",children:(0,a.jsxs)("div",{ref:i,className:"container mx-auto px-4",children:[(0,a.jsxs)("div",{className:"max-w-6xl mx-auto text-center mb-16",children:[(0,a.jsx)("h2",{className:"text-4xl md:text-5xl font-bold text-foreground mb-4",children:"Meu Dashboard"}),(0,a.jsx)("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto leading-relaxed mb-7",children:"Aqui voc\xea pode acompanhar suas ideias, coment\xe1rios e dados."}),(0,a.jsxs)("h3",{className:"text-xl md:text-2xl font-bold text-foreground",children:["Bem-vindo, ",(null==s?void 0:s.displayName)||(null==s?void 0:s.email)]})]}),(0,a.jsx)("div",{className:"flex justify-center mb-8",children:(0,a.jsxs)("div",{className:"flex bg-background rounded-lg p-1 border border-border space-x-2",children:[(0,a.jsx)(o.z,{variant:"ideias"===D?"default":"ghost",onClick:()=>U("ideias"),className:"cursor-pointer",children:"Minhas Ideias"}),(0,a.jsx)(o.z,{variant:"comentarios"===D?"default":"ghost",onClick:()=>U("comentarios"),className:"cursor-pointer",children:"Meus Coment\xe1rios"}),(0,a.jsx)(o.z,{variant:"dados"===D?"default":"ghost",onClick:()=>U("dados"),className:"cursor-pointer",children:"Meus Dados"})]})}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[("ideias"===D||"comentarios"===D)&&(0,a.jsx)("div",{className:"lg:col-span-1 mb-8",children:(0,a.jsxs)(l.Zb,{className:"bg-card border-border sticky top-24",children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"Compartilhe sua ideia"})}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)("form",{onSubmit:M,className:"space-y-4",children:[(0,a.jsx)(c.I,{placeholder:"Cidade, Pa\xeds",value:w.city,onChange:e=>k({...w,city:e.target.value}),required:!0,disabled:!s,pattern:"^[^,]+,\\s*[^,]+$",title:"Digite no formato: Cidade, Pa\xeds"}),(0,a.jsx)(u.g,{placeholder:s?"Descreva sua ideia...":"Fa\xe7a login para adicionar ideias",value:w.idea,onChange:e=>k({...w,idea:e.target.value}),required:!0,rows:3,disabled:!s,minLength:10,title:"A ideia deve ter pelo menos 10 caracteres"}),(0,a.jsx)(o.z,{type:"submit",disabled:!s,onClick:()=>U("ideias"),className:"cursor-pointer",children:s?"Compartilhar":"Fa\xe7a login para compartilhar"})]})})]})}),"dados"!==D&&(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[0===H.length&&(0,a.jsx)("div",{className:"px-10 py-5 text-xl md:text-base text-muted-foreground",children:"ideias"===D?"Voc\xea ainda n\xe3o tem ideias cadastradas.":"comentarios"===D?"Voc\xea ainda n\xe3o comentou em nenhuma ideia.":""}),H.map(e=>{var t,i,r;return(0,a.jsx)(l.Zb,{className:"bg-card border-border hover:shadow-lg transition-shadow relative",children:(0,a.jsxs)(l.aY,{children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"bg-emerald-500/10 p-2 rounded-full",children:e.photoURL?(0,a.jsx)(g.default,{src:e.photoURL,alt:e.author,width:32,height:32,className:"rounded-full"}):(0,a.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,a.jsx)(h.Z,{className:"h-4 w-4 text-white"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold",children:e.author}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.city})]})]}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:_(e.time)})]}),(0,a.jsx)("p",{className:"mb-4 leading-relaxed",children:e.idea}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(o.z,{onClick:()=>F(e.id),variant:"ghost",size:"sm",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 mr-1 ".concat((null===(t=e.likedBy)||void 0===t?void 0:t.length)?"text-red-500":"text-white")}),e.likes]}),(0,a.jsxs)("div",{className:"flex items-center justify-end w-full gap-2",children:[(0,a.jsxs)(o.z,{onClick:()=>I({open:!0,ideaId:e.id}),variant:"ghost",size:"sm",disabled:!s,children:[(0,a.jsx)(f.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"ml-1",children:(null===(i=e.comments)||void 0===i?void 0:i.length)||0})]}),(null==s?void 0:s.email)&&e.email&&s.email===e.email&&(0,a.jsx)(o.z,{onClick:()=>Y(e.id),variant:"ghost",size:"sm",children:(0,a.jsx)(m.Z,{className:"h-4 w-4 text-red-500"})})]})]}),(null===(r=e.comments)||void 0===r?void 0:r.length)?$(e.comments,e.id):null]})},e.id)}),Q.length>5&&(0,a.jsxs)("div",{className:"flex justify-center gap-4 mt-6",children:[(0,a.jsx)(o.z,{onClick:()=>A(e=>Math.max(e-1,1)),disabled:1===E,children:"Anterior"}),(0,a.jsxs)("span",{className:"flex items-center gap-2",children:["P\xe1gina ",E," de ",W]}),(0,a.jsx)(o.z,{onClick:()=>A(e=>Math.min(e+1,W)),disabled:E===W,children:"Pr\xf3ximo"})]})]})]}),"dados"===D&&(0,a.jsx)("div",{className:"max-w-md mx-auto",children:(0,a.jsxs)(l.Zb,{className:"bg-card border-border",children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"Minhas Informa\xe7\xf5es"})}),(0,a.jsxs)(l.aY,{className:"flex flex-col items-center gap-4",children:[s?s.photoURL?(0,a.jsx)(g.default,{src:s.photoURL,alt:s.displayName||"Usu\xe1rio",width:100,height:100,className:"rounded-full"}):(0,a.jsx)("div",{className:"h-24 w-24 rounded-full bg-gray-300 flex items-center justify-center",children:(0,a.jsx)(h.Z,{className:"h-12 w-12 text-white"})}):(0,a.jsx)("div",{className:"text-center text-muted-foreground",children:"Carregando informa\xe7\xf5es..."}),s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"font-semibold text-lg",children:s.displayName||s.email}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Email: ",s.email]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["UID: ",s.uid]})]})]})]})}),S.open&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-card p-6 rounded-lg w-96",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Adicionar Coment\xe1rio"}),(0,a.jsxs)("form",{onSubmit:q,className:"space-y-3",children:[(0,a.jsx)(c.I,{placeholder:"Seu nome",value:C.author||"",onChange:e=>z({...C,author:e.target.value}),required:!0,disabled:!!s}),(0,a.jsx)(u.g,{placeholder:"Coment\xe1rio",value:C.text||"",onChange:e=>z({...C,text:e.target.value}),rows:3,required:!0}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(o.z,{type:"button",variant:"ghost",onClick:()=>I({open:!1}),children:"Cancelar"}),(0,a.jsx)(o.z,{type:"submit",children:"Enviar"})]})]})]})})]})})}var y=i(5082);function N(){let[e,t]=(0,r.useState)(!0),[i,l]=(0,r.useState)(null),o=(0,s.useRouter)();return((0,r.useEffect)(()=>{let e=(0,n.Aj)(d.I,e=>{e?l(e):o.replace("/login"),t(!1)});return()=>e()},[o]),e)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)(y.$,{className:"w-16 h-16"})}):(0,a.jsx)(j,{user:i})}},2869:function(e,t,i){"use strict";i.d(t,{z:function(){return l}});var a=i(7437);i(2265);var r=i(5293),s=i(535),n=i(4508);let d=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:t,variant:i,size:s,asChild:l=!1,...o}=e,c=l?r.g7:"button";return(0,a.jsx)(c,{"data-slot":"button",className:(0,n.cn)(d({variant:i,size:s,className:t})),...o})}},6070:function(e,t,i){"use strict";i.d(t,{Ol:function(){return n},Zb:function(){return s},aY:function(){return l},ll:function(){return d}});var a=i(7437);i(2265);var r=i(4508);function s(e){let{className:t,...i}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...i})}function n(e){let{className:t,...i}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...i})}function d(e){let{className:t,...i}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...i})}function l(e){let{className:t,...i}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",t),...i})}},5186:function(e,t,i){"use strict";i.d(t,{I:function(){return s}});var a=i(7437);i(2265);var r=i(4508);function s(e){let{className:t,type:i,...s}=e;return(0,a.jsx)("input",{type:i,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...s})}},5082:function(e,t,i){"use strict";i.d(t,{$:function(){return r}});var a=i(7437);function r(e){let{className:t}=e;return(0,a.jsx)("div",{className:"animate-spin rounded-full border-4 border-t-4 border-gray-200 border-t-blue-500 ".concat(t||"w-8 h-8")})}},6818:function(e,t,i){"use strict";i.d(t,{g:function(){return s}});var a=i(7437);i(2265);var r=i(4508);function s(e){let{className:t,...i}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,r.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...i})}},7293:function(e,t,i){"use strict";i.d(t,{A:function(){return l},I:function(){return d},db:function(){return o}});var a=i(738),r=i(2148),s=i(5978);let n=(0,a.ZF)({apiKey:"AIzaSyBPx9Yu1fNRzptPdKjtSJjZ5SjBrW-mv1g",authDomain:"cidades-resilientes.firebaseapp.com",projectId:"cidades-resilientes",storageBucket:"cidades-resilientes.firebasestorage.app",messagingSenderId:"531178995997",appId:"1:531178995997:web:c20fa8e6f1afce48e421f4"}),d=(0,r.v0)(n),l=new r.hJ,o=(0,s.ad)(n)},4508:function(e,t,i){"use strict";i.d(t,{cn:function(){return s}});var a=i(1994),r=i(3335);function s(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,r.m6)((0,a.W)(t))}}},function(e){e.O(0,[609,15,2,129,971,117,744],function(){return e(e.s=4158)}),_N_E=e.O()}]);